var priceInputs=document.querySelectorAll(".filters-form__price"),minPriceField=document.querySelector("#min-price-field"),maxPriceField=document.querySelector("#max-price-field"),minPrice=+minPriceField.getAttribute("min"),maxPrice=+maxPriceField.getAttribute("max"),AVERAGE_CHAR_WIDTH=8,PIXEL_CORRECTION=2,grips=document.querySelectorAll(".slider-contoller__grip"),gripMin=document.querySelector(".slider-contoller__grip--min"),gripMax=document.querySelector(".slider-contoller__grip--max"),gripWidth=gripMin.offsetWidth,gripGrowingDelta=1,gripMinPosition=0,gripMaxPosition=0,sliderController=document.querySelector(".slider-contoller"),sliderControllerWidth=sliderController.offsetWidth-gripWidth,costPerPixel=(maxPrice-minPrice)/sliderControllerWidth,sliderBar=document.querySelector(".slider-contoller__current-range"),sliderBarMin=0,sliderBarMax=0,resizeInputs=function(){for(var i=0;i<priceInputs.length;i++)priceInputs[i].style.width=priceInputs[i].value.length*AVERAGE_CHAR_WIDTH+PIXEL_CORRECTION+"px"},updateFields=function(){minPriceField.value=Math.round(minPrice+gripMinPosition*costPerPixel),maxPriceField.value=Math.round(minPrice+gripMaxPosition*costPerPixel),resizeInputs()},checkGripPosition=function(i){i===gripMin&&(gripMinPosition<0&&(gripMinPosition=0),sliderControllerWidth-gripWidth<gripMinPosition&&(gripMinPosition=sliderControllerWidth-gripWidth)),i===gripMax&&(sliderControllerWidth<gripMaxPosition&&(gripMaxPosition=sliderControllerWidth),gripMaxPosition<gripWidth&&(gripMaxPosition=gripWidth))},updateGrips=function(i){gripMinPosition=(+minPriceField.value-minPrice)/costPerPixel,checkGripPosition(gripMin),gripMaxPosition=(+maxPriceField.value-minPrice)/costPerPixel,checkGripPosition(gripMax);var e=gripWidth-(gripMaxPosition-gripMinPosition);0<e&&(i===minPriceField&&(gripMaxPosition+=e),i===maxPriceField&&(gripMinPosition-=e)),sliderBarMin=gripMinPosition,sliderBarMax=gripMaxPosition,gripMin.style.left=gripMinPosition+"px",gripMax.style.left=gripMaxPosition+"px",sliderBar.style.marginLeft=sliderBarMin+"px",sliderBar.style.marginRight=sliderControllerWidth-sliderBarMax+"px"},addPriceFieldHandler=function(e){e.addEventListener("input",function(i){resizeInputs(),updateGrips(i.target)}),e.addEventListener("change",function(i){(+e.value<minPrice||""==e.value)&&(e.value=minPrice),+e.value>maxPrice&&(e.value=maxPrice),+maxPriceField.value<+minPriceField.value&&(i.target===minPriceField&&(maxPriceField.value=minPriceField.value),i.target===maxPriceField&&(minPriceField.value=maxPriceField.value)),e.value=+e.value,resizeInputs()})},addGripHandler=function(e){e.onmousedown=function(r){r.preventDefault();var i=e.getBoundingClientRect().left+window.pageXOffset,n=r.pageX-i-gripGrowingDelta,t=sliderController.getBoundingClientRect().left+window.pageXOffset;document.onmousemove=function(i){var e;e=minPriceField,gripPosition=i.pageX-t-n,r.target===gripMin&&(gripMinPosition=gripPosition,checkGripPosition(gripMin)),r.target===gripMax&&(gripMaxPosition=gripPosition,checkGripPosition(gripMax),e=maxPriceField),updateFields(),updateGrips(e)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}}};updateGrips(minPriceField),resizeInputs();for(var i=0;i<priceInputs.length;i++)addPriceFieldHandler(priceInputs[i]);for(i=0;i<grips.length;i++)addGripHandler(grips[i]);
